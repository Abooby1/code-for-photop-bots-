/*!
 * slnks - slnks.com API client.
 * 
 * Veselin Todorov <hi@vesln.com>
 * MIT License
 */

/**
 * Module dependencies.
 */
var request = require('request');

/**
 * Expose `slnks` client.
 */
var slnks = module.exports;

/**
 * Status.
 * 
 * @type {Object}
 */
slnks.status = {
  1: 'Internal error',
  2: 'No url.',
  3: 'Invalid url.',
  4: 'Banned url.'
};

/**
 * URL address.
 * 
 * @type {String}
 */
slnks.url = 'http://slnks.com/api';

/**
 * Returns a shorter link.
 * 
 * @param {String} URL.
 * @param {Function} Callback.
 */
slnks.get = function(url, fn) {
  var status = this.status;
  var opts = {
    url: this.url,
    method: 'POST',
    form: {url: url}
  };
  
  request(opts, function(err, resp, body) {
    if (err) return fn(err);
    body = JSON.parse(body);
    if (body.status) return fn(new Error(status[body.status]));
    fn(null, body.url);
  });
};